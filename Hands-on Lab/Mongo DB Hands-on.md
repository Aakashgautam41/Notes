---
tags:
  - Java
  - Spring-boot
  - Hands-on
  - Mongodb
---

## üöÄ Project Overview

- **Goal:** A minimal¬†REST CRUD service backed by MongoDB.
    
- **Tech Stack:** Spring Boot 3.5 (Java 21), Spring Web, Spring Data MongoDB, MongoDB Atlas / local instance.
    
- **Domain Model:** `Book` ‚Üí `id`, `title`, `author`, `year`.
    
- **Endpoints:** Create, Read (list/by id), Update, Delete ‚Üí `/api/books`.
    

---

## üß© Project Structure (Key Files)

**Main app**

```java
@SpringBootApplication
public class MongoDemoApplication {
    public static void main(String[] args) {
        SpringApplication.run(MongoDemoApplication.class, args);
    }
}
```

**Model**

```java
@Document(collection = "books")
public class Book {
    @Id private String id;
    private String title;
    private String author;
    private Integer year;
}
```

**Repository**

```java
public interface BookRepository extends MongoRepository<Book, String> { }
```

**Controller**

```java
@RestController
@RequestMapping("/api/books")
public class BookController {
    private final BookRepository repo;
    public BookController(BookRepository repo) { this.repo = repo; }
}
```

**Config**

```properties
spring.application.name=mongo-demo
spring.data.mongodb.uri=mongodb+srv://<user>:<pass>@cluster.mongodb.net/books
```

---

## üß† MongoDB Core Concepts (Essentials)

|Concept|Explanation|
|---|---|
|**Document model**|JSON-like (BSON) format; schema-flexible and human-readable.|
|**_id**|Primary key; autogenerated `ObjectId` if not set. Spring handles mapping to `String`.|
|**Collection**|Logical grouping of related documents (e.g., `books`).|
|**Indexes**|Accelerate reads; default on `_id`. Create custom with `@Indexed`.|
|**Aggregation**|Pipeline-style query processing for grouping, transformation, joins.|
|**Transactions**|Multi-document consistency (on replica sets/shards). Use sparingly.|

---

## üß¨ Spring Data MongoDB Mapping

|Annotation|Purpose|
|---|---|
|`@Document("books")`|Maps class ‚Üí collection.|
|`@Id`|Marks primary identifier (auto-generated if null).|
|`@Indexed(unique = true)`|Adds unique constraint at DB level.|
|`@Field("published_year")`|Maps Java field ‚Üí Mongo field name.|

---

## üßÆ CRUD Operations via Repository

Spring Data provides CRUD out of the box:

```java
repo.save(book);                // insert/update
repo.findAll();                 // list
repo.findById(id);              // read one
repo.deleteById(id);            // delete
```

**Custom finders** follow naming conventions:

```java
List<Book> findByAuthor(String author);
List<Book> findByTitleContainingIgnoreCase(String part);
```

---

## üåê REST Endpoints

|Method|Endpoint|Description|
|---|---|---|
|`GET`|`/api/books`|List all|
|`GET`|`/api/books/{id}`|Get by ID|
|`POST`|`/api/books`|Create new (201 Created)|
|`PUT`|`/api/books/{id}`|Update existing (404 if not found)|
|`DELETE`|`/api/books/{id}`|Delete (204 No Content)|

**Example PUT Implementation**

```java
@PutMapping("/{id}")
public ResponseEntity<Book> update(@PathVariable String id, @RequestBody Book book) {
    if (!repo.existsById(id)) return ResponseEntity.notFound().build();
    book.setId(id);
    return ResponseEntity.ok(repo.save(book));
}
```

> ‚úÖ Interview Tip: Check existence before `PUT` to preserve correct HTTP semantics.

---

## ‚öôÔ∏è Configuration & Environment Profiles

**URIs:**

```properties
# Local
spring.data.mongodb.uri=mongodb://localhost:27017/mongo_demo

# Production (secured)
spring.data.mongodb.uri=${MONGODB_URI}
```

**Run with profile:**

```bash
./mvnw spring-boot:run -Dspring-boot.run.profiles=prod
```

---

## üß∞ Sample curl Requests

```bash
# Create
curl -X POST http://localhost:8080/api/books \
  -H "Content-Type: application/json" \
  -d '{"title":"Dune","author":"Frank Herbert","year":1965}'

# List all
curl http://localhost:8080/api/books

# Get one
curl http://localhost:8080/api/books/{id}

# Update
curl -X PUT http://localhost:8080/api/books/{id} \
  -H "Content-Type: application/json" \
  -d '{"title":"Dune (Updated)","author":"Frank Herbert","year":1965}'

# Delete
curl -X DELETE http://localhost:8080/api/books/{id}
```

---

## üí° Practical MongoDB Concepts Demonstrated

- **Schema-less design:** Add/remove fields anytime; only present fields are stored.
    
- **Automatic `_id` handling:** Generated if absent during insert.
    
- **Upsert behavior:** `save()` inserts or updates based on id presence.
    
- **Repository abstraction:** Eliminates boilerplate DAOs.
    
- **Proper HTTP codes:** 201 ‚Üí create, 404 ‚Üí missing, 204 ‚Üí delete success.
    

---

## üöÄ Going Beyond (Interview Value Add)

### ‚úÖ Validation

```java
@Valid @RequestBody Book book
@NotBlank private String title;
@Min(1000) @Max(2025) private int year;
```

### ‚úÖ DTOs & Mapping

Avoid exposing DB entities.  
Use `BookRequest` / `BookResponse` + MapStruct or ModelMapper.

### ‚úÖ Indexing

```java
@CompoundIndex(name="author_title_idx", def="{'author':1,'title':1}")
```

### ‚úÖ Aggregation Example

```java
@Autowired MongoTemplate template;
Aggregation agg = newAggregation(
    match(Criteria.where("author").is("Frank Herbert")),
    group("author").count().as("bookCount")
);
```

### ‚úÖ Pagination

```java
Page<Book> page = repo.findAll(PageRequest.of(0, 10, Sort.by("title")));
```

### ‚úÖ Partial Updates

```java
template.updateFirst(
  query(where("_id").is(id)), 
  Update.update("title", "New Title"), 
  Book.class
);
```

---

## ‚öñÔ∏è Common Interview Anchors

|Topic|Key Talking Points|
|---|---|
|**MongoDB vs RDBMS**|Flexible schema, embedded docs, scale-out via sharding, no joins.|
|**Indexes**|Boost reads, affect writes; use for frequent filters/sorts.|
|**Aggregation vs MapReduce**|Aggregation is modern and efficient; MapReduce is legacy.|
|**Transactions**|Use only for multi-doc consistency (replica sets/shards).|
|**Schema design**|Embed for atomicity, reference for reuse. Watch 16MB doc limit.|
|**Repository vs MongoTemplate**|Repos for CRUD; Template for complex queries, updates, aggregation.|

---

## üß™ Testing Best Practices

- **Repo tests:** `@DataMongoTest` + embedded MongoDB (`de.flapdoodle.embed.mongo`).
    
- **Web tests:** `@WebMvcTest` with mocked repository.
    
- **E2E tests:** Testcontainers for realistic MongoDB behavior.
    

---

## üõ†Ô∏è Troubleshooting Quick Fixes

|Issue|Fix|
|---|---|
|**Connection errors**|Check IP allowlist (Atlas), URI format, DB name, and credentials.|
|**Local Mongo not found**|Ensure `mongod` is running on port 27017.|
|**ObjectId‚ÄìString mismatch**|Use `String id` and let Spring map automatically.|
|**400/404 issues**|Add validation + global exception handling (`@ControllerAdvice`).|

